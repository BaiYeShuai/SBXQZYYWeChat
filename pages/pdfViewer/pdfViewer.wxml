<view class="container">
  <view class="header">
    <button class="back-btn" bindtap="goBack">
      <image src="/images/back.png" mode="widthFix"></image>
    </button>
    <text class="title">报告详情</text>
    <button class="menu-btn" bindtap="showMenu">
      <image src="/images/menu.png" mode="widthFix"></image>
    </button>
  </view>

  <view class="view-mode-switch">
    <button 
      class="mode-btn {{viewMode === 'online' ? 'active' : ''}}" 
      bindtap="switchToOnlineView"
    >
      在线预览
    </button>
    <button 
      class="mode-btn {{viewMode === 'download' ? 'active' : ''}}" 
      bindtap="switchToDownloadView"
    >
      下载查看
    </button>
  </view>

  <!-- 加载中 -->
  <view wx:if="{{loading && viewMode === 'online'}}" class="loading">
    <van-loading type="spinner" color="#1677ff" size="40rpx" />
    <text>加载中...</text>
  </view>

  <!-- 在线预览 -->
  <web-view 
    wx:if="{{!loading && !error && viewMode === 'online'}}" 
    src="{{webViewUrl}}"
    binderror="onWebViewError"
    bindload="onWebViewLoad"
  ></web-view>

  <!-- 在线预览错误 -->
  <view wx:if="{{error && viewMode === 'online'}}" class="error">
    <image src="/images/error.png" mode="widthFix"></image>
    <text>{{errorMsg}}</text>
    <button bindtap="reloadReport">重新加载</button>
  </view>

  <!-- 下载查看区域 -->
  <view wx:if="{{viewMode === 'download'}}">
    <view wx:if="{{!downloadError && !tempFilePath}}" class="downloading">
      <van-loading type="spinner" color="#1677ff" size="40rpx" />
      <text>下载中...</text>
    </view>

    <view wx:if="{{downloadError}}" class="error">
      <image src="/images/error.png" mode="widthFix"></image>
      <text>{{downloadErrorMsg}}</text>
      <button bindtap="reloadReport">重新下载</button>
    </view>

    <view wx:if="{{tempFilePath && !downloadError}}" class="download-success">
      <image src="/images/success.png" mode="widthFix"></image>
      <text>下载完成，请点击打开</text>
      <button bindtap="openPdfFile" data-path="{{tempFilePath}}">打开报告</button>
    </view>
  </view>
</view>
